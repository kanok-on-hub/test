<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
  <title>Leave Request Form</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; -webkit-tap-highlight-color: transparent; }
    .card-section { background: white; border-radius: 1rem; border: 1px solid #e2e8f0; padding: 1.25rem; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }
    .type-btn { width: 100%; text-align: left; padding: 1rem; border: 1px solid #e2e8f0; border-radius: 1rem; background: white; transition: all 0.2s; cursor: pointer; }
    .type-btn.selected { border-color: #2563eb; background-color: #eff6ff; border-width: 2px; }
    .input-field { background-color: #f8fafc; border: 1px solid #e2e8f0; border-radius: 0.75rem; padding: 0.75rem; width: 100%; outline: none; transition: all 0.2s; font-size: 1rem; }
    .input-field:focus { border-color: #2563eb; background-color: white; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
    .field-error { border: 2px solid #ef4444 !important; background-color: #fef2f2 !important; }
    .sticky-bottom { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e2e8f0; padding: 1rem; padding-bottom: calc(1rem + env(safe-area-inset-bottom)); z-index: 50; }
    .animate-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body class="pb-32">

<div id="app" class="max-w-md mx-auto">
  <div class="bg-white px-6 pt-12 pb-6 rounded-b-[2.5rem] shadow-sm border-b border-gray-100 mb-6">
    <div class="flex items-center gap-4">
      <div id="avatarBox" class="w-14 h-14 rounded-full overflow-hidden border-2 border-blue-50 hidden shadow-inner">
        <img id="profileImg" src="" class="w-full h-full object-cover">
      </div>
      <div>
        <h1 class="text-xl font-bold text-slate-900 leading-tight">Leave Request üìù</h1>
        <p id="userGreet" class="text-slate-500 text-sm font-medium">Loading profile...</p>
      </div>
    </div>
  </div>

  <div class="px-5 space-y-6">
    <div class="space-y-3">
      <label class="text-sm font-bold text-slate-700 ml-1">Leave Type <span class="text-red-500">*</span></label>
      <div class="grid grid-cols-2 gap-3">
        <button type="button" onclick="selectType(this, 'Sick')" class="type-btn"><span class="text-2xl block mb-1">ü§í</span><span class="font-semibold text-slate-700">Sick</span></button>
        <button type="button" onclick="selectType(this, 'Annual')" class="type-btn"><span class="text-2xl block mb-1">üèñÔ∏è</span><span class="font-semibold text-slate-700">Annual</span></button>
        <button type="button" onclick="selectType(this, 'Personal')" class="type-btn"><span class="text-2xl block mb-1">üöó</span><span class="font-semibold text-slate-700">Personal</span></button>
        <button type="button" onclick="selectType(this, 'Other')" class="type-btn"><span class="text-2xl block mb-1">üìù</span><span class="font-semibold text-slate-700">Other</span></button>
      </div>
      <input type="hidden" id="leaveTypeValue">
    </div>

    <div id="otherField" class="hidden animate-in space-y-2">
      <label class="text-sm font-bold text-blue-600 ml-1">Please specify Other type <span class="text-red-500">*</span></label>
      <input type="text" id="otherSpecify" class="input-field border-blue-100" placeholder="e.g. Ordination, Marriage, etc.">
    </div>

    <div class="card-section space-y-4">
      <label class="text-sm font-bold text-slate-700 block">Date Range <span class="text-red-500">*</span></label>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <span class="text-[10px] uppercase font-bold text-slate-400 block mb-1 ml-1">Start Date</span>
          <input type="date" id="startDate" onchange="validateOnFly()" class="input-field text-center">
        </div>
        <div>
          <span class="text-[10px] uppercase font-bold text-slate-400 block mb-1 ml-1">End Date</span>
          <input type="date" id="endDate" onchange="validateOnFly()" class="input-field text-center">
        </div>
      </div>
    </div>

    <div class="card-section space-y-3">
      <label class="text-sm font-bold text-slate-700 block">Duration <span class="text-red-500">*</span></label>
      <div class="flex bg-slate-100 p-1 rounded-xl">
        <button id="durFull" onclick="selectDur(this, 'Full Day')" class="flex-1 py-2 text-sm font-bold rounded-lg bg-white shadow-sm text-blue-600 transition-all">Full Day</button>
        <button onclick="selectDur(this, 'Morning')" class="flex-1 py-2 text-sm font-medium text-slate-500">Morning</button>
        <button onclick="selectDur(this, 'Afternoon')" class="flex-1 py-2 text-sm font-medium text-slate-500">Afternoon</button>
      </div>
      <input type="hidden" id="durationValue" value="Full Day">
    </div>

    <div class="space-y-2">
      <label class="text-sm font-bold text-slate-700 ml-1">Reason <span class="text-red-500">*</span></label>
      <textarea id="reason" rows="3" oninput="validateOnFly()" class="input-field" placeholder="Please specify reason..."></textarea>
    </div>

    <div id="fileCard" class="card-section border-dashed border-2 flex items-center justify-between cursor-pointer" onclick="document.getElementById('fileInput').click()">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 bg-blue-50 rounded-full flex items-center justify-center text-blue-500">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"></path></svg>
        </div>
        <div>
          <p id="fileTitle" class="text-sm font-bold text-slate-700">Attachment (Optional)</p>
          <p id="fileSubtitle" class="text-[10px] text-slate-400 italic">Required if Sick Leave ‚â• 3 days</p>
        </div>
      </div>
      <input type="file" id="fileInput" class="hidden" onchange="handleFileChange(this)">
    </div>
  </div>

  <div class="sticky-bottom">
    <button id="submitBtn" onclick="handleSubmit()" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-bold text-lg shadow-lg shadow-blue-200 transition-all active:scale-[0.98]">
      Submit
    </button>
  </div>
</div>

<div id="loader" class="fixed inset-0 bg-white/80 backdrop-blur-sm z-[100] flex flex-col items-center justify-center hidden">
  <div class="w-10 h-10 border-4 border-slate-200 border-t-blue-600 rounded-full animate-spin mb-3"></div>
  <p class="font-bold text-slate-600">Submitting...</p>
</div>

<script>
  const LIFF_ID = "2008997153-OdZGJzVg";
  let userProfile = null;

  function selectType(btn, val) {
    document.querySelectorAll('.type-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    document.getElementById('leaveTypeValue').value = val;
    
    // Toggle Other Specify Field
    const otherField = document.getElementById('otherField');
    if (val === 'Other') {
      otherField.classList.remove('hidden');
    } else {
      otherField.classList.add('hidden');
      document.getElementById('otherSpecify').value = '';
    }
    validateOnFly();
  }

  function selectDur(btn, val) {
    btn.parentElement.querySelectorAll('button').forEach(b => {
      b.className = "flex-1 py-2 text-sm font-medium text-slate-500";
    });
    btn.className = "flex-1 py-2 text-sm font-bold rounded-lg bg-white shadow-sm text-blue-600 transition-all";
    document.getElementById('durationValue').value = val;
  }

  function handleFileChange(input) {
    if(input.files[0]) {
      document.getElementById('fileTitle').innerText = input.files[0].name.substring(0, 15) + "...";
      document.getElementById('fileTitle').classList.add('text-blue-600');
    }
    validateOnFly();
  }

  function validateOnFly() {
    const s = new Date(document.getElementById('startDate').value);
    const e = new Date(document.getElementById('endDate').value);
    const days = Math.ceil((e - s) / 86400000) + 1;
    const type = document.getElementById('leaveTypeValue').value;
    const file = document.getElementById('fileInput').files[0];
    const card = document.getElementById('fileCard');

    // Logic: Sick >= 3 days needs attachment
    if (type === 'Sick' && days >= 3 && !file) {
      card.classList.add('field-error');
      document.getElementById('fileTitle').innerText = "Medical Certificate Required! *";
      document.getElementById('fileTitle').classList.add('text-red-600');
      return false;
    }
    card.classList.remove('field-error');
    document.getElementById('fileTitle').classList.remove('text-red-600');
    return true;
  }

  async function handleSubmit() {
    const type = document.getElementById('leaveTypeValue').value;
    const otherSpec = document.getElementById('otherSpecify').value.trim();
    const reason = document.getElementById('reason').value.trim();
    
    if(!type) return alert("Please select Leave Type");
    if(type === 'Other' && !otherSpec) return alert("Please specify the type of 'Other' leave");
    if(!reason) return alert("Please specify reason");
    if(!validateOnFly()) return alert("Attachment is required for sick leave >= 3 days");

    document.getElementById('loader').classList.remove('hidden');
    
    // Success Simulation
    setTimeout(() => {
      alert("‚úÖ Your request has been submitted!");
      document.getElementById('loader').classList.add('hidden');
      liff.closeWindow();
    }, 2000);
  }

  liff.init({ liffId: LIFF_ID }).then(async () => {
    if(!liff.isLoggedIn()) liff.login();
    userProfile = await liff.getProfile();
    document.getElementById('userGreet').innerText = `Hi, ${userProfile.displayName}`;
    if(userProfile.pictureUrl) {
      document.getElementById('profileImg').src = userProfile.pictureUrl;
      document.getElementById('avatarBox').classList.remove('hidden');
    }
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('startDate').value = today;
    document.getElementById('endDate').value = today;
  });
</script>
</body>
</html>
